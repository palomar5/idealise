%li
  .meta
    - if feedback.user
      != link_to feedback.user.try(:name) || "no name", feedback.user
    != kudos_sparkline_tag(feedback.kudos_history, "ffffff")
    #{feedback.created_at.to_s :short }
    != button_to "+", project_feedback_feedback_ratings_path(feedback.project, feedback, :rating => 1 )
    != button_to "-", project_feedback_feedback_ratings_path(feedback.project, feedback, :rating => -1)
    - unless feedback.parent
      != link_to_function "reply", "$('#reply_on_project_#{feedback.project.id}').toggle('fast')"
  != simple_format(h(feedback.text))
  - unless feedback.parent
    - form_for(:feedback, :url => project_feedbacks_path(feedback.project), :html => { :class => 'column width3 first', :id => "reply_on_project_#{feedback.project.id}", :style => 'display:none;' }) do |f|
      != hidden_field_tag :parent_id, feedback.project.id
      != f.error_messages
      %label.width3.multilinex3.first
        Reply here:
        != f.text_area :text
      %p.width3.first.actions
        != f.submit 'Submit'

  - unless feedback.children.empty?
    %ul.feedback.first
      != render :partial => 'feedbacks/feedback', :collection => feedback.children, :as => :feedback
    